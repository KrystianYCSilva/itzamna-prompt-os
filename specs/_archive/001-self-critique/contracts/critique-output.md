# Protocol Interface: Self-Critique Output

**Feature Branch**: `001-self-critique`  
**Date**: 2026-02-02  
**Type**: Protocol Contract

---

## Overview

This contract defines the expected output format when an AI agent executes the Self-Critique protocol. Following this format ensures consistent integration with the Human Gate protocol.

---

## Input

The self-critique protocol receives:

```yaml
input:
  artifact_content: string     # The full content of the generated artifact
  artifact_type: ArtifactType  # code | skill | persona | documentation
  artifact_name: string        # Name/title of the artifact
  context:
    existing_skills: string[]  # List from skills/INDEX.md (for redundancy check)
    constitution: object       # T0/T1/T2 rules for compliance check
```

---

## Output Format

### Full Critique Result (Internal)

```yaml
# Self-Critique Protocol Output
# Generated by: AI agent following SELF-CRITIQUE.md

critique:
  # Required fields
  score: <integer 0-100>
  band: <"Excellent" | "Good" | "Fair" | "Poor">
  artifact_type: <"code" | "skill" | "persona" | "documentation">
  
  # Dimension breakdown (all 4 required)
  dimensions:
    completeness:
      score: <integer 0-25>
      notes: <string, optional>
    clarity:
      score: <integer 0-25>
      notes: <string, optional>
    correctness:
      score: <integer 0-25>
      notes: <string, optional>
    best_practices:
      score: <integer 0-25>
      notes: <string, optional>
  
  # Quality indicators (min 1 strength required)
  strengths:
    - <string: what the artifact does well>
    # ... up to 5 items
  
  weaknesses:
    - <string: what needs improvement>
    # ... up to 5 items (can be empty if score >= 90)
  
  # Improvement recommendations (required if score < 90)
  suggestions:
    - <string: actionable improvement>
    # ... 1-5 items
  
  # Redundancy detection (optional, only if similar items found)
  similar_items:
    - name: <string: skill name>
      similarity: <integer 60-100>
      note: <string: brief explanation>
    # ... up to 5 items
  
  # T0 compliance (required)
  constitution_check:
    t0_violations: <integer, must be 0>
    t1_warnings: <integer>
    notes: <string, optional>
```

---

## Output Examples

### Example 1: High-Quality Skill (Score 92)

```yaml
critique:
  score: 92
  band: "Excellent"
  artifact_type: "skill"
  
  dimensions:
    completeness:
      score: 23
      notes: "All sections present, 3 examples"
    clarity:
      score: 24
      notes: "Clear instructions, logical flow"
    correctness:
      score: 22
      notes: "Examples verified to work"
    best_practices:
      score: 23
      notes: "Follows skill template conventions"
  
  strengths:
    - "Comprehensive coverage of use cases"
    - "Well-structured with clear sections"
    - "Practical, executable examples"
  
  weaknesses: []
  
  suggestions:
    - "Consider adding a troubleshooting section"
  
  similar_items: []
  
  constitution_check:
    t0_violations: 0
    t1_warnings: 0
```

### Example 2: Fair-Quality Code (Score 62)

```yaml
critique:
  score: 62
  band: "Fair"
  artifact_type: "code"
  
  dimensions:
    completeness:
      score: 18
      notes: "Missing error handling"
    clarity:
      score: 20
      notes: "Readable but sparse comments"
    correctness:
      score: 12
      notes: "Edge case not handled"
    best_practices:
      score: 12
      notes: "Function exceeds 30 lines"
  
  strengths:
    - "Core logic is correct"
    - "Variable names are descriptive"
  
  weaknesses:
    - "No error handling for invalid input"
    - "Main function is 45 lines (limit: 30)"
    - "Missing null check on parameter"
  
  suggestions:
    - "Add try-catch block for file operations"
    - "Extract helper function to reduce main function size"
    - "Add null check: if (!param) return early"
    - "Add unit tests for edge cases"
  
  similar_items: []
  
  constitution_check:
    t0_violations: 0
    t1_warnings: 2
    notes: "T1-QUAL-04 (small functions), T1-ARCH-04 (error handling)"
```

### Example 3: Skill with Redundancy Warning (Score 75)

```yaml
critique:
  score: 75
  band: "Good"
  artifact_type: "skill"
  
  dimensions:
    completeness:
      score: 20
    clarity:
      score: 22
    correctness:
      score: 18
    best_practices:
      score: 15
  
  strengths:
    - "Good examples with context"
    - "Clear trigger patterns"
  
  weaknesses:
    - "Only 2 examples provided"
    - "Constraints could be more specific"
  
  suggestions:
    - "Add third example showing error case"
    - "Make constraint #2 more specific"
    - "Consider merging with similar existing skill"
  
  similar_items:
    - name: "rest-api-design"
      similarity: 72
      note: "Both cover API endpoint patterns"
    - name: "http-methods"
      similarity: 65
      note: "Overlapping HTTP verb guidance"
  
  constitution_check:
    t0_violations: 0
    t1_warnings: 0
```

---

## Validation Rules

### Required Fields

| Field | Required | Condition |
|-------|----------|-----------|
| `score` | Always | Integer 0-100 |
| `band` | Always | Must match score range |
| `artifact_type` | Always | Valid enum value |
| `dimensions.*` | Always | All 4 dimensions |
| `strengths` | Always | Min 1 item |
| `weaknesses` | If score < 90 | Min 1 item |
| `suggestions` | If score < 90 | Min 1 item, max 5 |
| `similar_items` | If found | Only items >= 60% similarity |
| `constitution_check` | Always | Must have t0_violations: 0 |

### Score Calculation

```
score = dimensions.completeness.score 
      + dimensions.clarity.score 
      + dimensions.correctness.score 
      + dimensions.best_practices.score
```

### Band Mapping

| Score Range | Band |
|-------------|------|
| 90-100 | Excellent |
| 70-89 | Good |
| 50-69 | Fair |
| 0-49 | Poor |

---

## Protocol Integration Point

This output is consumed by:

1. **HUMAN-GATE.md** - Displays formatted critique in approval interface
2. **MEMORY.md** - Records critique for feedback correlation (future)

---

*Contract version: 1.0.0 | Created: 2026-02-02*
